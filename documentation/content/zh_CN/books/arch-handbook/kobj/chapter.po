# SOME DESCRIPTIVE TITLE
# Copyright (C) YEAR The FreeBSD Project
# This file is distributed under the same license as the FreeBSD Documentation package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
msgid ""
msgstr ""
"Project-Id-Version: FreeBSD Documentation VERSION\n"
"POT-Creation-Date: 2021-02-21 18:54-0300\n"
"PO-Revision-Date: 2021-04-11 20:10+0000\n"
"Last-Translator: Anonymous <noreply@weblate.org>\n"
"Language-Team: Chinese (Simplified) <https://translate-dev.freebsd.org/"
"projects/documentation/booksarch-handbookkobjchapter/zh_CN/>\n"
"Language: zh_CN\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=1; plural=0;\n"
"X-Generator: Weblate 4.5.2\n"

#. type: YAML Front Matter: title
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:1
#, no-wrap
msgid "Chapter 3. Kernel Objects"
msgstr ""

#. type: Title =
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:8
#, no-wrap
msgid "Kernel Objects"
msgstr "内核对象"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:33
#, fuzzy
msgid ""
"Kernel Objects, or _Kobj_ provides an object-oriented C programming system "
"for the kernel. As such the data being operated on carries the description "
"of how to operate on it. This allows operations to be added and removed from "
"an interface at run time and without breaking binary compatibility."
msgstr ""
"内核对象，也就是<firstterm>Kobj</firstterm>，为内核提供了一种面向对象的C语言编程方式。被操作的数据也承载操作它的方法。这使得在"
"不破坏二进制兼容性的前提下，某一个接口能够增/减相应的操作。"

#. type: Title ==
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:35
#, no-wrap
msgid "Terminology"
msgstr "术语"

#. type: Labeled list
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:37
#, no-wrap
msgid "Object"
msgstr "对象"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:39
msgid "A set of data - data structure - data allocation."
msgstr "数据集合-数据结构-数据分配的集合。"

#. type: Labeled list
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:40
#, no-wrap
msgid "Method"
msgstr "方法"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:42
msgid "An operation - function."
msgstr "某一种操作──函数。"

#. type: Labeled list
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:43
#, no-wrap
msgid "Class"
msgstr "类"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:45
msgid "One or more methods."
msgstr "一种或多种方法。"

#. type: Labeled list
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:46
#, no-wrap
msgid "Interface"
msgstr "接口"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:48
msgid "A standard set of one or more methods."
msgstr "一种或多种方法的一个标准集合。"

#. type: Title ==
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:50
#, no-wrap
msgid "Kobj Operation"
msgstr "Kobj的工作流程"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:53
msgid ""
"Kobj works by generating descriptions of methods. Each description holds a "
"unique id as well as a default function. The description's address is used "
"to uniquely identify the method within a class' method table."
msgstr "Kobj工作时，产生方法的描述。每个描述有一个唯一的标识和一个缺省函数。 某个描述的地址被用来在一个类的方法表里唯一的标识方法。"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:55
msgid ""
"A class is built by creating a method table associating one or more "
"functions with method descriptions. Before use the class is compiled. The "
"compilation allocates a cache and associates it with the class. A unique id "
"is assigned to each method description within the method table of the class "
"if not already done so by another referencing class compilation. For every "
"method to be used a function is generated by script to qualify arguments and "
"automatically reference the method description for a lookup. The generated "
"function looks up the method by using the unique id associated with the "
"method description as a hash into the cache associated with the object's "
"class. If the method is not cached the generated function proceeds to use "
"the class' table to find the method. If the method is found then the "
"associated function within the class is used; otherwise, the default "
"function associated with the method description is used."
msgstr ""
"构建一个类，就是要建立一张方法表，并将这张表关联到一个或多个函数(方法)； "
"这些函数(方法)都带有方法描述。使用前，类要被编译。编译时要为这个类分配一些缓存。 在方法表中的每个方法描述都会被指派一个唯一的标识， "
"除非已经被其它引用它的类在编译时指派了标识。对于每个将要被使用的方法， 都会由脚本生成一个函数(方法查找函数)，以解析外来参数， "
"并在被查询时给出方法描述的地址。被生成的函数(方法查找函数) 凭着那个方法描述的唯一标识按Hash的方法查找对象的类的缓存。 "
"如果这个方法不在缓存中，函数会查找使用类的方法表。如果这个方法被找到了， 类里的相关函数(也就是某个方法的实现代码)就会被使用。 "
"否则，这个方法描述的缺省函数将被使用。"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:57
msgid "These indirections can be visualized as the following:"
msgstr "这些过程可被表示如下："

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:61
#, no-wrap
msgid "object->cache<->class\n"
msgstr ""

#. type: Title ==
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:64
#, no-wrap
msgid "Using Kobj"
msgstr "使用Kobj"

#. type: Title ===
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:66
#, no-wrap
msgid "Structures"
msgstr "结构"

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:71
#, fuzzy, no-wrap
msgid "struct kobj_method\n"
msgstr "struct kobj_method\n"

#. type: Title ===
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:73
#, no-wrap
msgid "Functions"
msgstr "结构"

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:83
#, fuzzy, no-wrap
msgid ""
"void kobj_class_compile(kobj_class_t cls);\n"
"void kobj_class_compile_static(kobj_class_t cls, kobj_ops_t ops);\n"
"void kobj_class_free(kobj_class_t cls);\n"
"kobj_t kobj_create(kobj_class_t cls, struct malloc_type *mtype, int "
"mflags);\n"
"void kobj_init(kobj_t obj, kobj_class_t cls);\n"
"void kobj_delete(kobj_t obj, struct malloc_type *mtype);\n"
msgstr ""
"void kobj_class_compile(kobj_class_t cls);\n"
"void kobj_class_compile_static(kobj_class_t cls, kobj_ops_t ops);\n"
"void kobj_class_free(kobj_class_t cls);\n"
"kobj_t kobj_create(kobj_class_t cls, struct malloc_type *mtype, int mflags);"
"\n"
"void kobj_init(kobj_t obj, kobj_class_t cls);\n"
"void kobj_delete(kobj_t obj, struct malloc_type *mtype);\n"

#. type: Title ===
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:85
#, no-wrap
msgid "Macros"
msgstr "宏"

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:93
#, fuzzy, no-wrap
msgid ""
"KOBJ_CLASS_FIELDS\n"
"KOBJ_FIELDS\n"
"DEFINE_CLASS(name, methods, size)\n"
"KOBJMETHOD(NAME, FUNC)\n"
msgstr ""
"KOBJ_CLASS_FIELDS\n"
"KOBJ_FIELDS\n"
"DEFINE_CLASS(name, methods, size)\n"
"KOBJMETHOD(NAME, FUNC)\n"

#. type: Title ===
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:95
#, no-wrap
msgid "Headers"
msgstr "头文件"

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:101
#, no-wrap
msgid ""
"<sys/param.h>\n"
"<sys/kobj.h>\n"
msgstr ""

#. type: Title ===
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:103
#, no-wrap
msgid "Creating an Interface Template"
msgstr "建立一个接口的模板"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:106
#, fuzzy
msgid ""
"The first step in using Kobj is to create an Interface. Creating the "
"interface involves creating a template that the script "
"[.filename]#src/sys/kern/makeobjops.pl# can use to generate the header and "
"code for the method declarations and method lookup functions."
msgstr ""
"使用Kobj的第一步是建立一个接口。建立接口包括建立模板的工作。建立模板可用脚本<filename>src/sys/kern/makeobjops."
"pl</filename>完成，它会产生申明方法的头文件和代码，脚本还会生成方法查找函数。"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:108
msgid ""
"Within this template the following keywords are used: `#include`, "
"`INTERFACE`, `CODE`, `METHOD`, `STATICMETHOD`, and `DEFAULT`."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:110
msgid ""
"The `#include` statement and what follows it is copied verbatim to the head "
"of the generated code file."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:112
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:121
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:130
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:144
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:157
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:182
msgid "For example:"
msgstr "例如："

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:116
#, no-wrap
msgid "#include <sys/foo.h>\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:119
msgid ""
"The `INTERFACE` keyword is used to define the interface name. This name is "
"concatenated with each method name as [interface name]_[method name]. Its "
"syntax is INTERFACE [interface name];."
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:125
#, fuzzy, no-wrap
msgid "INTERFACE foo;\n"
msgstr "INTERFACE foo;\n"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:128
msgid ""
"The `CODE` keyword copies its arguments verbatim into the code file. Its "
"syntax is `CODE { [whatever] };`"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:139
#, fuzzy, no-wrap
msgid ""
"CODE {\n"
"\tstruct foo * foo_alloc_null(struct bar *)\n"
"\t{\n"
"\t\treturn NULL;\n"
"}\n"
"};\n"
msgstr ""
"CODE {\n"
"\tstruct foo * foo_alloc_null(struct bar *)\n"
"\t{\n"
"\t\treturn NULL;\n"
"}\n"
"};\n"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:142
msgid ""
"The `METHOD` keyword describes a method. Its syntax is `METHOD [return type] "
"[method name] { [object [, arguments]] };`"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:152
#, fuzzy, no-wrap
msgid ""
"METHOD int bar {\n"
"\tstruct object *;\n"
"\tstruct foo *;\n"
"\tstruct bar;\n"
"};\n"
msgstr ""
"METHOD int bar {\n"
"\tstruct object *;\n"
"\tstruct foo *;\n"
"\tstruct bar;\n"
"};\n"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:155
msgid ""
"The `DEFAULT` keyword may follow the `METHOD` keyword. It extends the "
"`METHOD` key word to include the default function for method. The extended "
"syntax is `METHOD [return type] [method name] { [object; [other arguments]] "
"}DEFAULT [default function];`"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:165
#, fuzzy, no-wrap
msgid ""
"METHOD int bar {\n"
"\tstruct object *;\n"
"\tstruct foo *;\n"
"\tint bar;\n"
"} DEFAULT foo_hack;\n"
msgstr ""
"METHOD int bar {\n"
"\tstruct object *;\n"
"\tstruct foo *;\n"
"\tint bar;\n"
"} DEFAULT foo_hack;\n"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:168
#, fuzzy
msgid ""
"The `STATICMETHOD` keyword is used like the `METHOD` keyword except the kobj "
"data is not at the head of the object structure so casting to kobj_t would "
"be incorrect. Instead `STATICMETHOD` relies on the Kobj data being "
"referenced as 'ops'. This is also useful for calling methods directly out of "
"a class's method table."
msgstr ""
"关键词<literal>STATICMETHOD</literal>类似关键词<literal>METHOD</literal>。对于每个Kobj对象，一"
"般其头部都有一些Kobj专有的数据。<literal>METHOD</literal>定义的方法就假设这些专有数据位于对象头部；假如对象头部没有这些专有数"
"据，这些方法对这个对象的访问就可能出错。而<literal>STATICMETHOD</literal>定义的对象可以不受这个限制：这样描述出的方法，其操"
"作的数据不由这个类的某个对象实例给出，而是全都由调用这个方法时的操作数(译者注:即参数)给出。这也对于在某个类的方法表之外调用这个方法有用。"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:170
msgid "Other complete examples:"
msgstr "其它完整的例子:"

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:175
#, fuzzy, no-wrap
msgid ""
"src/sys/kern/bus_if.m\n"
"src/sys/kern/device_if.m\n"
msgstr ""
"src/sys/kern/bus_if.m\n"
"src/sys/kern/device_if.m\n"

#. type: Title ===
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:177
#, no-wrap
msgid "Creating a Class"
msgstr "创建类"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:180
#, fuzzy
msgid ""
"The second step in using Kobj is to create a class. A class consists of a "
"name, a table of methods, and the size of objects if Kobj's object handling "
"facilities are used. To create the class use the macro `DEFINE_CLASS()`. To "
"create the method table create an array of kobj_method_t terminated by a "
"NULL entry. Each non-NULL entry may be created using the macro "
"`KOBJMETHOD()`."
msgstr ""
"使用Kobj的第二步是建立一个类。一个类的组有名字、方法表；假如使用了Kobj的“对象管理工具”(Object Handling "
"Facilities)，类中还包含对象的大小。建立类时使用宏<function>DEFINE_CLASS()</function>。建立方法表时，"
"须建立一个 kobj_method_t 数组，用NULL项结尾。每个非 NULL "
"项可用宏<function>KOBJMETHOD()</function>建立。"

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:186
#, no-wrap
msgid "DEFINE_CLASS(fooclass, foomethods, sizeof(struct foodata));\n"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:192
#, no-wrap
msgid ""
"kobj_method_t foomethods[] = {\n"
"\tKOBJMETHOD(bar_doo, foo_doo),\n"
"\tKOBJMETHOD(bar_foo, foo_foo),\n"
"\t{ NULL, NULL}\n"
"};\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:195
msgid ""
"The class must be \"compiled\". Depending on the state of the system at the "
"time that the class is to be initialized a statically allocated cache, \"ops "
"table\" have to be used. This can be accomplished by declaring a `struct "
"kobj_ops` and using `kobj_class_compile_static();` otherwise, "
"`kobj_class_compile()` should be used."
msgstr ""

#. type: Title ===
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:196
#, no-wrap
msgid "Creating an Object"
msgstr "建立一个对象"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:199
#, fuzzy
msgid ""
"The third step in using Kobj involves how to define the object. Kobj object "
"creation routines assume that Kobj data is at the head of an object. If this "
"in not appropriate you will have to allocate the object yourself and then "
"use `kobj_init()` on the Kobj portion of it; otherwise, you may use "
"`kobj_create()` to allocate and initialize the Kobj portion of the object "
"automatically. `kobj_init()` may also be used to change the class that an "
"object uses."
msgstr ""
"使用Kobj的第三步是定义对象。Kobj对象建立程序假定Kobj专有数据在一个对象的头部。如果不是如此，应当先自行分配对象，再使用<function>ko"
"bj_init()</function>初始化对象中的Kobj专有数据；其实可以使用<function>kobj_create()</function>分"
"配对象，并自动初始化对象中的Kobj专有内容。<function>kobj_init()</function>也可以用来改变一个对象所使用的类。"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:201
msgid "To integrate Kobj into the object you should use the macro KOBJ_FIELDS."
msgstr "将Kobj的数据集成到对象中要使用宏KOBJ_FIELDS。"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:203
msgid "For example"
msgstr "例如"

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:211
#, fuzzy, no-wrap
msgid ""
"struct foo_data {\n"
"\tKOBJ_FIELDS;\n"
"\tfoo_foo;\n"
"\tfoo_bar;\n"
"};\n"
msgstr ""
"struct foo_data {\n"
"\tKOBJ_FIELDS;\n"
"\tfoo_foo;\n"
"\tfoo_bar;\n"
"};\n"

#. type: Title ===
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:213
#, no-wrap
msgid "Calling Methods"
msgstr "调用方法"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:216
msgid ""
"The last step in using Kobj is to simply use the generated functions to use "
"the desired method within the object's class. This is as simple as using the "
"interface name and the method name with a few modifications. The interface "
"name should be concatenated with the method name using a '_' between them, "
"all in upper case."
msgstr "使用Kobj的最后一部就是通过生成的函数调用对象类中的方法。调用时，接口名与方法名用'_'接合，而且全部使用大写字母。"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:218
msgid ""
"For example, if the interface name was foo and the method was bar then the "
"call would be:"
msgstr "例如，接口名为foo，方法为bar，调用就是:"

#. type: delimited block . 4
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:222
#, fuzzy, no-wrap
msgid "[return value = ] FOO_BAR(object [, other parameters]);\n"
msgstr "[返回值 = ] FOO_BAR(对象 [, 其它参数]);\n"

#. type: Title ===
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:224
#, no-wrap
msgid "Cleaning Up"
msgstr "善后处理"

#. type: Plain text
#: documentation/content/en/books/arch-handbook/kobj/chapter.adoc:226
msgid ""
"When an object allocated through `kobj_create()` is no longer needed "
"`kobj_delete()` may be called on it, and when a class is no longer being "
"used `kobj_class_free()` may be called on it."
msgstr ""
