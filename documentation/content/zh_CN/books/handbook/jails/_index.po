# SOME DESCRIPTIVE TITLE
# Copyright (C) YEAR The FreeBSD Project
# This file is distributed under the same license as the FreeBSD Documentation package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
msgid ""
msgstr ""
"Project-Id-Version: FreeBSD Documentation VERSION\n"
"POT-Creation-Date: 2021-02-21 18:55-0300\n"
"PO-Revision-Date: 2021-04-05 12:39+0000\n"
"Last-Translator: Anonymous <noreply@weblate.org>\n"
"Language-Team: Chinese (Simplified) <https://translate-dev.freebsd.org/"
"projects/documentation/bookshandbookjails_index/zh_CN/>\n"
"Language: zh_CN\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=UTF-8\n"
"Content-Transfer-Encoding: 8bit\n"
"Plural-Forms: nplurals=1; plural=0;\n"
"X-Generator: Weblate 4.5.2\n"

#. type: YAML Front Matter: part
#: documentation/content/en/books/handbook/jails/_index.adoc:1
#, no-wrap
msgid "Part III. System Administration"
msgstr ""

#. type: YAML Front Matter: title
#: documentation/content/en/books/handbook/jails/_index.adoc:1
#, no-wrap
msgid "Chapter 15. Jails"
msgstr ""

#. type: Title =
#: documentation/content/en/books/handbook/jails/_index.adoc:9
#, no-wrap
msgid "Jails"
msgstr "Jails"

#. type: Title ==
#: documentation/content/en/books/handbook/jails/_index.adoc:45
#, no-wrap
msgid "Synopsis"
msgstr "简介"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:48
msgid ""
"Since system administration is a difficult task, many tools have been "
"developed to make life easier for the administrator. These tools often "
"enhance the way systems are installed, configured, and maintained. One of "
"the tools which can be used to enhance the security of a FreeBSD system is "
"_jails_. Jails have been available since FreeBSD 4.X and continue to be "
"enhanced in their usefulness, performance, reliability, and security."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:50
msgid ""
"Jails build upon the man:chroot[2] concept, which is used to change the root "
"directory of a set of processes. This creates a safe environment, separate "
"from the rest of the system. Processes created in the chrooted environment "
"can not access files or resources outside of it. For that reason, "
"compromising a service running in a chrooted environment should not allow "
"the attacker to compromise the entire system. However, a chroot has several "
"limitations. It is suited to easy tasks which do not require much "
"flexibility or complex, advanced features. Over time, many ways have been "
"found to escape from a chrooted environment, making it a less than ideal "
"solution for securing services."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:52
msgid ""
"Jails improve on the concept of the traditional chroot environment in "
"several ways. In a traditional chroot environment, processes are only "
"limited in the part of the file system they can access. The rest of the "
"system resources, system users, running processes, and the networking "
"subsystem are shared by the chrooted processes and the processes of the host "
"system. Jails expand this model by virtualizing access to the file system, "
"the set of users, and the networking subsystem. More fine-grained controls "
"are available for tuning the access of a jailed environment. Jails can be "
"considered as a type of operating system-level virtualization."
msgstr ""
"Jail 通过多种方式改进了传统 chroot 环境的概念。在传统的 chroot 环境中，进程仅限于它们可以访问的文件系统部分。chroot "
"中的进程和主机系统的进程共享其余的系统资源，系统用户，运行的进程和网络子系统。Jail "
"通过虚拟化对文件系统，用户集和网络子系统的访问来扩展此模型。可以使用更多细粒度的控件来调整监狱环境的访问。Jails可以被视为一种操作系统级别的虚拟化。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:54
msgid "A jail is characterized by four elements:"
msgstr "Jail 有四个基本特征："

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:56
msgid ""
"A directory subtree: the starting point from which a jail is entered. Once "
"inside the jail, a process is not permitted to escape outside of this "
"subtree."
msgstr "目录子树：进入 jail 的起点。一旦进入了 jail，进程就不再被允许访问这棵子树以外的对象。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:57
msgid "A hostname: which will be used by the jail."
msgstr ""
"主机名：将用于 jail 的主机名。 jail 主要用于存放网络服务， 因此在每个 mail 上能够标注一个有意义的主机名， "
"能够在很大程度上简化系统管理员的工作。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:58
msgid ""
"An IP address: which is assigned to the jail. The IP address of a jail is "
"often an alias address for an existing network interface."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:59
msgid ""
"A command: the path name of an executable to run inside the jail. The path "
"is relative to the root directory of the jail environment."
msgstr ""
"命令：准备在 jail 中执行的可执行文件的完整路径名。 这个命令是相对于 jail 环境的根目录的， 随 jail 环境的类型不同， "
"可能会有很多不同之处。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:61
msgid ""
"Jails have their own set of users and their own `root` account which are "
"limited to the jail environment. The `root` account of a jail is not allowed "
"to perform operations to the system outside of the associated jail "
"environment."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:63
msgid ""
"This chapter provides an overview of the terminology and commands for "
"managing FreeBSD jails. Jails are a powerful tool for both system "
"administrators, and advanced users."
msgstr "本章概述了用于管理 FreeBSD jail 的术语和命令。Jail 是系统管理员和高级用户的强大工具。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:65
msgid "After reading this chapter, you will know:"
msgstr "读完本章节，你将会知道："

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:67
msgid "What a jail is and what purpose it may serve in FreeBSD installations."
msgstr "什么是jail，它在FreeBSD 安装过程中的作用是什么。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:68
msgid "How to build, start, and stop a jail."
msgstr "如何联编、 启动和停止 jail。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:69
msgid "The basics of jail administration, both from inside and outside the jail."
msgstr "如何从 jail 内部或主机上进行管理的一些基础知识。"

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:73
msgid ""
"Jails are a powerful tool, but they are not a security panacea. While it is "
"not possible for a jailed process to break out on its own, there are several "
"ways in which an unprivileged user outside the jail can cooperate with a "
"privileged user inside the jail to obtain elevated privileges in the host "
"environment."
msgstr ""
"Jail 是一个强大的工具，但不是安全银弹。尽管被在 jail 中的进程不能越狱，但是有几种方法可以使 jail 外的非特权用户与 jail "
"内的特权用户合作，以在主机环境中获得提升的特权。"

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:75
msgid ""
"Most of these attacks can be mitigated by ensuring that the jail root is not "
"accessible to unprivileged users in the host environment. As a general rule, "
"untrusted users with privileged access to a jail should not be given access "
"to the host environment."
msgstr ""
"通过确保主机环境中的非特权用户无法访问 jail 中的 root 用户，可以缓解大多数此类攻击。不应授予对 jail 有特权访问的不可信用户访问主机环境。"

#. type: Title ==
#: documentation/content/en/books/handbook/jails/_index.adoc:78
#, no-wrap
msgid "Terms Related to Jails"
msgstr "与 Jail 相关的一些术语"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:81
msgid ""
"To facilitate better understanding of parts of the FreeBSD system related to "
"jails, their internals and the way they interact with the rest of FreeBSD, "
"the following terms are used further in this chapter:"
msgstr "为了帮助您更好地理解与 jail 有关的 FreeBSD 系统知识， 以及它们如何与 FreeBSD 的其它部分相互作用， 您应理解下列术语："

#. type: Labeled list
#: documentation/content/en/books/handbook/jails/_index.adoc:82
#, no-wrap
msgid "man:chroot[8] (command)"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:84
msgid ""
"Utility, which uses man:chroot[2] FreeBSD system call to change the root "
"directory of a process and all its descendants."
msgstr ""

#. type: Labeled list
#: documentation/content/en/books/handbook/jails/_index.adoc:85
#, no-wrap
msgid "man:chroot[2] (environment)"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:87
msgid ""
"The environment of processes running in a \"chroot\". This includes "
"resources such as the part of the file system which is visible, user and "
"group IDs which are available, network interfaces and other IPC mechanisms, "
"etc."
msgstr ""

#. type: Labeled list
#: documentation/content/en/books/handbook/jails/_index.adoc:88
#, no-wrap
msgid "man:jail[8] (command)"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:90
msgid ""
"The system administration utility which allows launching of processes within "
"a jail environment."
msgstr "用以在 jail 环境中运行进程的系统管理工具。"

#. type: Labeled list
#: documentation/content/en/books/handbook/jails/_index.adoc:91
#, no-wrap
msgid "host (system, process, user, etc.)"
msgstr "宿主 (系统、 进程、 用户等等)"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:93
msgid ""
"The controlling system of a jail environment. The host system has access to "
"all the hardware resources available, and can control processes both outside "
"of and inside a jail environment. One of the important differences of the "
"host system from a jail is that the limitations which apply to superuser "
"processes inside a jail are not enforced for processes of the host system."
msgstr ""
"能够控制 jail 环境的系统。 宿主系统能够访问全部可用的硬件资源， 并能够控制 jail 环境内外的进程。 宿主系统与 jail 的一项重要区别是， "
"在宿主系统中的超级用户进程， 并不像在 jail 中那样受到一系列限制。"

#. type: Labeled list
#: documentation/content/en/books/handbook/jails/_index.adoc:94
#, no-wrap
msgid "hosted (system, process, user, etc.)"
msgstr "hosted (系统、 进程、 用户等等)"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:96
msgid ""
"A process, user or other entity, whose access to resources is restricted by "
"a FreeBSD jail."
msgstr "可访问资源受 FreeBSD jail 限制的进程、 用户或其他实体。"

#. type: Title ==
#: documentation/content/en/books/handbook/jails/_index.adoc:98
#, no-wrap
msgid "Creating and Controlling Jails"
msgstr "创建和控制 Jail"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:101
msgid ""
"Some administrators divide jails into the following two types: \"complete\" "
"jails, which resemble a real FreeBSD system, and \"service\" jails, "
"dedicated to one application or service, possibly running with "
"privileges. This is only a conceptual division and the process of building a "
"jail is not affected by it. When creating a \"complete\" jail there are two "
"options for the source of the userland: use prebuilt binaries (such as those "
"supplied on an install media) or build from source."
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:102
#, no-wrap
msgid "Installing a Jail"
msgstr "安装 Jail"

#. type: Title ====
#: documentation/content/en/books/handbook/jails/_index.adoc:105
#, no-wrap
msgid "To install a Jail from the Internet"
msgstr "从互联网安装 jail"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:108
msgid ""
"The man:bsdinstall[8] tool can be used to fetch and install the binaries "
"needed for a jail. This will walk through the picking of a mirror, which "
"distributions will be installed into the destination directory, and some "
"basic configuration of the jail:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:112
#, no-wrap
msgid "# bsdinstall jail /here/is/the/jail\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:115
msgid ""
"Once the command is complete, the next step is configuring the host to run "
"the jail."
msgstr "命令完成后，下一步来配置主机以运行 jail。"

#. type: Title ====
#: documentation/content/en/books/handbook/jails/_index.adoc:117
#, no-wrap
msgid "To install a Jail from an ISO"
msgstr "从 ISO 文件创建 Jail"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:120
msgid ""
"To install the userland from installation media, first create the root "
"directory for the jail. This can be done by setting the `DESTDIR` variable "
"to the proper location."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:122
msgid "Start a shell and define `DESTDIR`:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:127
#, no-wrap
msgid ""
"# sh\n"
"# export DESTDIR=/here/is/the/jail\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:130
msgid ""
"Mount the install media as covered in man:mdconfig[8] when using the install "
"ISO:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:135
#, no-wrap
msgid ""
"# mount -t cd9660 /dev/`mdconfig -f cdimage.iso` /mnt\n"
"# cd /mnt/usr/freebsd-dist/\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:138
msgid ""
"Extract the binaries from the tarballs on the install media into the "
"declared destination. Minimally, only the base set needs to be extracted, "
"but a complete install can be performed when preferred."
msgstr "解压获取到的用户环境文件到之前定义好的位置。至少需要 base（base.txz）环境，其他部分可按需安装。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:140
msgid "To install just the base system:"
msgstr "安装 base 系统："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:144
#, no-wrap
msgid "# tar -xf base.txz -C $DESTDIR\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:147
msgid "To install everything except the kernel:"
msgstr "安装除内核以外所有部分："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:151
#, no-wrap
msgid "# for set in base ports; do tar -xf $set.txz -C $DESTDIR ; done\n"
msgstr ""

#. type: Title ====
#: documentation/content/en/books/handbook/jails/_index.adoc:154
#, no-wrap
msgid "To build and install a Jail from source"
msgstr "从源码编译安装 Jail"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:157
msgid "The man:jail[8] manual page explains the procedure for building a jail:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:167
#, no-wrap
msgid ""
"# setenv D /here/is/the/jail\n"
"# mkdir -p $D      <.>\n"
"# cd /usr/src\n"
"# make buildworld  <.>\n"
"# make installworld DESTDIR=$D  <.>\n"
"# make distribution DESTDIR=$D  <.>\n"
"# mount -t devfs devfs $D/dev   <.>\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:170
msgid ""
"<.> Selecting a location for a jail is the best starting point. This is "
"where the jail will physically reside within the file system of the jail's "
"host. A good choice can be [.filename]#/usr/jail/jailname#, where _jailname_ "
"is the hostname identifying the jail. Usually, [.filename]#/usr/# has enough "
"space for the jail file system, which for \"complete\" jails is, "
"essentially, a replication of every file present in a default installation "
"of the FreeBSD base system."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:172
msgid ""
"<.> If you have already rebuilt your userland using `make world` or `make "
"buildworld`, you can skip this step and install your existing userland into "
"the new jail."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:175
msgid ""
"<.> This command will populate the directory subtree chosen as jail's "
"physical location on the file system with the necessary binaries, libraries, "
"manual pages and so on.  <.> The `distribution` target for make installs "
"every needed configuration file. In simple words, it installs every "
"installable file of [.filename]#/usr/src/etc/# to the [.filename]#/etc# "
"directory of the jail environment: [.filename]#$D/etc/#."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:177
msgid ""
"<.> Mounting the man:devfs[8] file system inside a jail is not required. On "
"the other hand, any, or almost any application requires access to at least "
"one device, depending on the purpose of the given application. It is very "
"important to control access to devices from inside a jail, as improper "
"settings could permit an attacker to do nasty things in the jail. Control "
"over man:devfs[8] is managed through rulesets which are described in the "
"man:devfs[8] and man:devfs.conf[5] manual pages."
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:178
#, no-wrap
msgid "Configuring the Host"
msgstr "设定 Host"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:181
msgid ""
"Once a jail is installed, it can be started by using the man:jail[8] "
"utility. The man:jail[8] utility takes four mandatory arguments which are "
"described in the <<jails-synopsis>>. Other arguments may be specified too, "
"e.g., to run the jailed process with the credentials of a specific user. The "
"`_command_` argument depends on the type of the jail; for a _virtual "
"system_, [.filename]#/etc/rc# is a good choice, since it will replicate the "
"startup sequence of a real FreeBSD system. For a _service_ jail, it depends "
"on the service or application that will run within the jail."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:183
msgid ""
"Jails are often started at boot time and the FreeBSD [.filename]#rc# "
"mechanism provides an easy way to do this."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:186
msgid "Configure jail parameters in [.filename]#jail.conf#:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:198
#, no-wrap
msgid ""
"www {\n"
"    host.hostname = www.example.org;           # Hostname\n"
"    ip4.addr = 192.168.0.10;                   # IP address of the jail\n"
"    path = \"/usr/jail/www\";                    # Path to the jail\n"
"    devfs_ruleset = \"www_ruleset\";             # devfs ruleset\n"
"    mount.devfs;                               # Mount devfs inside the "
"jail\n"
"    exec.start = \"/bin/sh /etc/rc\";            # Start command\n"
"    exec.stop = \"/bin/sh /etc/rc.shutdown\";    # Stop command\n"
"}\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:202
msgid "  Configure jails to start at boot time in [.filename]#rc.conf#:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:206
#, no-wrap
msgid "jail_enable=\"YES\"   # Set to NO to disable starting of any jails\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:209
msgid ""
"  The default startup of jails configured in man:jail.conf[5], will run the "
"[.filename]#/etc/rc# script of the jail, which assumes the jail is a "
"complete virtual system. For service jails, the default startup command of "
"the jail should be changed, by setting the `exec.start` option "
"appropriately."
msgstr ""

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:213
msgid ""
"For a full list of available options, please see the man:jail.conf[5] manual "
"page."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:216
msgid ""
"man:service[8] can be used to start or stop a jail by hand, if an entry for "
"it exists in [.filename]#jail.conf#:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:221
#, no-wrap
msgid ""
"# service jail start www\n"
"# service jail stop www\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:224
msgid ""
"Jails can be shut down with man:jexec[8]. Use man:jls[8] to identify the "
"jail's `JID`, then use man:jexec[8] to run the shutdown script in that jail."
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:231
#, no-wrap
msgid ""
"# jls\n"
"   JID  IP Address      Hostname                      Path\n"
"     3  192.168.0.10    www                           /usr/jail/www\n"
"# jexec 3 /etc/rc.shutdown\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:234
msgid "More information about this can be found in the man:jail[8] manual page."
msgstr ""

#. type: Title ==
#: documentation/content/en/books/handbook/jails/_index.adoc:236
#, no-wrap
msgid "Fine Tuning and Administration"
msgstr "微调和管理"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:239
msgid ""
"There are several options which can be set for any jail, and various ways of "
"combining a host FreeBSD system with jails, to produce higher level "
"applications. This section presents:"
msgstr ""
"您可以为 jail 设置许多不同的选项， 并让 FreeBSD 宿主系统以不同的方式与 jail 交互， 以支持更高级别的应用。 这一节将介绍："

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:241
msgid ""
"Some of the options available for tuning the behavior and security "
"restrictions implemented by a jail installation."
msgstr "一些用于微调 jail 行为和安全限制的选项。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:242
msgid ""
"Some of the high-level applications for jail management, which are available "
"through the FreeBSD Ports Collection, and can be used to implement overall "
"jail-based solutions."
msgstr "一些可以通过 FreeBSD Ports 套件安装的高级 jail 管理应用程序， 这些程序可以用于实现一般的基于 jail 的解决方案。"

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:244
#, no-wrap
msgid "System Tools for Jail Tuning in FreeBSD"
msgstr "FreeBSD 提供的用于微调 jail 的系统工具"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:247
msgid ""
"Fine tuning of a jail's configuration is mostly done by setting "
"man:sysctl[8] variables. A special subtree of sysctl exists as a basis for "
"organizing all the relevant options: the `security.jail.*` hierarchy of "
"FreeBSD kernel options. Here is a list of the main jail-related sysctls, "
"complete with their default value. Names should be self-explanatory, but for "
"more information about them, please refer to the man:jail[8] and "
"man:sysctl[8] manual pages."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:249
msgid "`security.jail.set_hostname_allowed: 1`"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:250
msgid "`security.jail.socket_unixiproute_only: 1`"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:251
msgid "`security.jail.sysvipc_allowed: 0`"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:252
msgid "`security.jail.enforce_statfs: 2`"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:253
msgid "`security.jail.allow_raw_sockets: 0`"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:254
msgid "`security.jail.chflags_allowed: 0`"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:255
msgid "`security.jail.jailed: 0`"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:257
msgid ""
"These variables can be used by the system administrator of the _host system_ "
"to add or remove some of the limitations imposed by default on the `root` "
"user. Note that there are some limitations which cannot be removed. The "
"`root` user is not allowed to mount or unmount file systems from within a "
"man:jail[8]. The `root` inside a jail may not load or unload man:devfs[8] "
"rulesets, set firewall rules, or do many other administrative tasks which "
"require modifications of in-kernel data, such as setting the `securelevel` "
"of the kernel."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:259
msgid ""
"The base system of FreeBSD contains a basic set of tools for viewing "
"information about the active jails, and attaching to a jail to run "
"administrative commands. The man:jls[8] and man:jexec[8] commands are part "
"of the base FreeBSD system, and can be used to perform the following simple "
"tasks:"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:261
msgid ""
"Print a list of active jails and their corresponding jail identifier (JID), "
"IP address, hostname and path."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:262
msgid ""
"Attach to a running jail, from its host system, and run a command inside the "
"jail or perform administrative tasks inside the jail itself. This is "
"especially useful when the `root` user wants to cleanly shut down a "
"jail. The man:jexec[8] utility can also be used to start a shell in a jail "
"to do administration in it; for example:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:266
#, no-wrap
msgid "# jexec 1 tcsh\n"
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:269
#, no-wrap
msgid "High-Level Administrative Tools in the FreeBSD Ports Collection"
msgstr "由 FreeBSD Ports 套件提供的高级管理工具"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:272
msgid ""
"Among the many third-party utilities for jail administration, one of the "
"most complete and useful is package:sysutils/ezjail[]. It is a set of "
"scripts that contribute to man:jail[8] management. Please refer to "
"<<jails-ezjail,the handbook section on ezjail>> for more information."
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:274
#, no-wrap
msgid "Keeping Jails Patched and up to Date"
msgstr "保持 jail 更新"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:277
msgid ""
"Jails should be kept up to date from the host operating system as attempting "
"to patch userland from within the jail may likely fail as the default "
"behavior in FreeBSD is to disallow the use of man:chflags[1] in a jail which "
"prevents the replacement of some files. It is possible to change this "
"behavior but it is recommended to use man:freebsd-update[8] to maintain "
"jails instead. Use `-b` to specify the path of the jail to be updated."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:279
msgid ""
"To update the jail to the latest patch release of the version of FreeBSD it "
"is already running, then execute the following commands on the host:"
msgstr "使用主机中最新的 FreeBSD 补丁更新 jail，请在主机中执行以下命令："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:284
#, no-wrap
msgid ""
"# freebsd-update -b /here/is/the/jail fetch\n"
"# freebsd-update -b /here/is/the/jail install\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:287
msgid ""
"To upgrade the jail to a new major or minor version, first upgrade the host "
"system as described in "
"crossref:cutting-edge[freebsdupdate-upgrade,“Performing Major and Minor "
"Version Upgrades”]. Once the host has been upgraded and rebooted, the jail "
"can then be upgraded. For example to upgrade from 12.0-RELEASE to "
"12.1-RELEASE, on the host run:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:294
#, no-wrap
msgid ""
"# freebsd-update -b /here/is/the/jail --currently-running 12.0-RELEASE -r "
"12.1-RELEASE upgrade\n"
"# freebsd-update -b /here/is/the/jail install\n"
"# service jail restart myjail\n"
"# freebsd-update -b /here/is/the/jail install\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:297
msgid ""
"Then, if it was a major version upgrade, reinstall all installed packages "
"and restart the jail again. This is required because the ABI version changes "
"when upgrading between major versions of FreeBSD. From the host:"
msgstr ""
"如果主版本号更新了，重新安装所有软件包并重启 jail。由于FreeBSD 主版本号更新时 ABI 版本也将改变，这部是必须的，在 Host 上执行："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:302
#, no-wrap
msgid ""
"# pkg -j myjail upgrade -f\n"
"# service jail restart myjail\n"
msgstr ""

#. type: Title ==
#: documentation/content/en/books/handbook/jails/_index.adoc:305
#, no-wrap
msgid "Updating Multiple Jails"
msgstr "更新多个 jail"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:308
msgid ""
"The management of multiple jails can become problematic because every jail "
"has to be rebuilt from scratch whenever it is upgraded. This can be time "
"consuming and tedious if a lot of jails are created and manually updated."
msgstr "多个 jail 的管理可能会成为问题，因为每个监狱必须从零开始构建，每当它被升级。如果创建并手动更新大量 jail，这可能既耗时又繁琐。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:310
msgid ""
"This section demonstrates one method to resolve this issue by safely sharing "
"as much as is possible between jails using read-only man:mount_nullfs[8] "
"mounts, so that updating is simpler. This makes it more attractive to put "
"single services, such as HTTP, DNS, and SMTP, into individual "
"jails. Additionally, it provides a simple way to add, remove, and upgrade "
"jails."
msgstr ""

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:314
msgid ""
"Simpler solutions exist, such as ezjail, which provides an easier method of "
"administering FreeBSD jails but is less versatile than this setup. ezjail is "
"covered in more detail in <<jails-ezjail>>."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:317
msgid "The goals of the setup described in this section are:"
msgstr "这节介绍的配置的目的包括："

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:319
msgid ""
"Create a simple and easy to understand jail structure that does not require "
"running a full installworld on each and every jail."
msgstr "建立简单并易于理解的 jail 结构。 也就是说不必为每个 jail 执行完整的 installworld 操作。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:320
msgid "Make it easy to add new jails or remove existing ones."
msgstr "使增删 jail 更容易。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:321
msgid "Make it easy to update or upgrade existing jails."
msgstr "使更新或升级 jail 更容易。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:322
msgid "Make it possible to run a customized FreeBSD branch."
msgstr "使运行自订的 FreeBSD 分支成为可能。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:323
msgid ""
"Be paranoid about security, reducing as much as possible the possibility of "
"compromise."
msgstr "对安全的更偏执的追求， 尽可能减少被攻陷的可能。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:324
msgid "Save space and inodes, as much as possible."
msgstr "尽可能节省空间和 inode。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:326
msgid ""
"This design relies on a single, read-only master template which is mounted "
"into each jail and one read-write device per jail. A device can be a "
"separate physical disc, a partition, or a vnode backed memory device. This "
"example uses read-write nullfs mounts."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:328
msgid "The file system layout is as follows:"
msgstr "下面的表中描述了文件系统格局："

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:330
msgid "The jails are based under the [.filename]#/home# partition."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:331
msgid "Each jail will be mounted under the [.filename]#/home/j# directory."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:332
msgid ""
"The template for each jail and the read-only partition for all of the jails "
"is [.filename]#/home/j/mroot#."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:333
msgid ""
"A blank directory will be created for each jail under the "
"[.filename]#/home/j# directory."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:334
msgid ""
"Each jail will have a [.filename]#/s# directory that will be linked to the "
"read-write portion of the system."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:335
msgid ""
"Each jail will have its own read-write system that is based upon "
"[.filename]#/home/j/skel#."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:336
msgid ""
"The read-write portion of each jail will be created in "
"[.filename]#/home/js#."
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:338
#, no-wrap
msgid "Creating the Template"
msgstr "建立模板"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:341
msgid "This section describes the steps needed to create the master template."
msgstr "这一节将介绍创建 jail 所需的只读主模板所需的步骤。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:343
msgid ""
"It is recommended to first update the host FreeBSD system to the latest "
"-RELEASE branch using the instructions in "
"crossref:cutting-edge[makeworld,“Updating FreeBSD from "
"Source”]. Additionally, this template uses the package:sysutils/cpdup[] "
"package or port and portsnap will be used to download the FreeBSD Ports "
"Collection."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:346
msgid ""
"First, create a directory structure for the read-only file system which will "
"contain the FreeBSD binaries for the jails. Then, change directory to the "
"FreeBSD source tree and install the read-only file system to the jail "
"template:"
msgstr ""
"首先， 需要为将要存放只读的 FreeBSD 执行文件的文件系统建立一个目录， 接着进入 FreeBSD 源代码的目录， 并在其中安装 jail 模板："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:352
#, no-wrap
msgid ""
"# mkdir /home/j /home/j/mroot\n"
"# cd /usr/src\n"
"# make installworld DESTDIR=/home/j/mroot\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:355
msgid ""
"Next, prepare a FreeBSD Ports Collection for the jails as well as a FreeBSD "
"source tree, which is required for mergemaster:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:362
#, no-wrap
msgid ""
"# cd /home/j/mroot\n"
"# mkdir usr/ports\n"
"# portsnap -p /home/j/mroot/usr/ports fetch extract\n"
"# cpdup /usr/src /home/j/mroot/usr/src\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:365
msgid "Create a skeleton for the read-write portion of the system:"
msgstr "创建系统中可读写部分的骨架："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:374
#, no-wrap
msgid ""
"# mkdir /home/j/skel /home/j/skel/home /home/j/skel/usr-X11R6 "
"/home/j/skel/distfiles\n"
"# mv etc /home/j/skel\n"
"# mv usr/local /home/j/skel/usr-local\n"
"# mv tmp /home/j/skel\n"
"# mv var /home/j/skel\n"
"# mv root /home/j/skel\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:377
msgid ""
"Use mergemaster to install missing configuration files. Then, remove the "
"extra directories that mergemaster creates:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:383
#, no-wrap
msgid ""
"# mergemaster -t /home/j/skel/var/tmp/temproot -D /home/j/skel -i\n"
"# cd /home/j/skel\n"
"# rm -R bin boot lib libexec mnt proc rescue sbin sys usr dev\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:386
msgid ""
"Now, symlink the read-write file system to the read-only file system. Ensure "
"that the symlinks are created in the correct [.filename]#s/# locations as "
"the creation of directories in the wrong locations will cause the "
"installation to fail."
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:399
#, no-wrap
msgid ""
"# cd /home/j/mroot\n"
"# mkdir s\n"
"# ln -s s/etc etc\n"
"# ln -s s/home home\n"
"# ln -s s/root root\n"
"# ln -s ../s/usr-local usr/local\n"
"# ln -s ../s/usr-X11R6 usr/X11R6\n"
"# ln -s ../../s/distfiles usr/ports/distfiles\n"
"# ln -s s/tmp tmp\n"
"# ln -s s/var var\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:402
msgid ""
"As a last step, create a generic [.filename]#/home/j/skel/etc/make.conf# "
"containing this line:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:406
#, no-wrap
msgid "WRKDIRPREFIX?=  /s/portbuild\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:409
msgid ""
"  This makes it possible to compile FreeBSD ports inside each jail. Remember "
"that the ports directory is part of the read-only system. The custom path "
"for `WRKDIRPREFIX` allows builds to be done in the read-write portion of "
"every jail."
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:411
#, no-wrap
msgid "Creating Jails"
msgstr "建立 Jail"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:414
msgid ""
"The jail template can now be used to setup and configure the jails in "
"[.filename]#/etc/rc.conf#. This example demonstrates the creation of 3 "
"jails: `NS`, `MAIL` and `WWW`."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:417
msgid ""
"Add the following lines to [.filename]#/etc/fstab#, so that the read-only "
"template for the jails and the read-write space will be available in the "
"respective jails:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:426
#, no-wrap
msgid ""
"/home/j/mroot   /home/j/ns     nullfs  ro  0   0\n"
"/home/j/mroot   /home/j/mail   nullfs  ro  0   0\n"
"/home/j/mroot   /home/j/www    nullfs  ro  0   0\n"
"/home/js/ns     /home/j/ns/s   nullfs  rw  0   0\n"
"/home/js/mail   /home/j/mail/s nullfs  rw  0   0\n"
"/home/js/www    /home/j/www/s  nullfs  rw  0   0\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:429
msgid ""
"  To prevent fsck from checking nullfs mounts during boot and dump from "
"backing up the read-only nullfs mounts of the jails, the last two columns "
"are both set to `0`."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:430
msgid "Configure the jails in [.filename]#/etc/rc.conf#:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:448
#, no-wrap
msgid ""
"jail_enable=\"YES\"\n"
"jail_set_hostname_allow=\"NO\"\n"
"jail_list=\"ns mail www\"\n"
"jail_ns_hostname=\"ns.example.org\"\n"
"jail_ns_ip=\"192.168.3.17\"\n"
"jail_ns_rootdir=\"/usr/home/j/ns\"\n"
"jail_ns_devfs_enable=\"YES\"\n"
"jail_mail_hostname=\"mail.example.org\"\n"
"jail_mail_ip=\"192.168.3.18\"\n"
"jail_mail_rootdir=\"/usr/home/j/mail\"\n"
"jail_mail_devfs_enable=\"YES\"\n"
"jail_www_hostname=\"www.example.org\"\n"
"jail_www_ip=\"62.123.43.14\"\n"
"jail_www_rootdir=\"/usr/home/j/www\"\n"
"jail_www_devfs_enable=\"YES\"\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:451
msgid ""
"  The `jail__name__rootdir` variable is set to [.filename]#/usr/home# "
"instead of [.filename]#/home# because the physical path of "
"[.filename]#/home# on a default FreeBSD installation is "
"[.filename]#/usr/home#. The `jail__name__rootdir` variable must _not_ be set "
"to a path which includes a symbolic link, otherwise the jails will refuse to "
"start."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:452
msgid "Create the required mount points for the read-only file system of each jail:"
msgstr "为每个 jail 创建所需的只读文件系统挂接点："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:456
#, no-wrap
msgid "# mkdir /home/j/ns /home/j/mail /home/j/www\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:459
msgid ""
"Install the read-write template into each jail using "
"package:sysutils/cpdup[]:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:466
#, no-wrap
msgid ""
"# mkdir /home/js\n"
"# cpdup /home/j/skel /home/js/ns\n"
"# cpdup /home/j/skel /home/js/mail\n"
"# cpdup /home/j/skel /home/js/www\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:469
msgid ""
"In this phase, the jails are built and prepared to run. First, mount the "
"required file systems for each jail, and then start them:"
msgstr "在这个阶段，已经创建好并准备运行。首先，为每个 Jail 挂载所需的文件系统，然后启动它们："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:474
#: documentation/content/en/books/handbook/jails/_index.adoc:568
#, no-wrap
msgid ""
"# mount -a\n"
"# service jail start\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:477
msgid ""
"The jails should be running now. To check if they have started correctly, "
"use `jls`. Its output should be similar to the following:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:485
#, no-wrap
msgid ""
"# jls\n"
"   JID  IP Address      Hostname                      Path\n"
"     3  192.168.3.17    ns.example.org                /home/j/ns\n"
"     2  192.168.3.18    mail.example.org              /home/j/mail\n"
"     1  62.123.43.14    www.example.org               /home/j/www\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:488
msgid ""
"At this point, it should be possible to log onto each jail, add new users, "
"or configure daemons. The `JID` column indicates the jail identification "
"number of each running jail. Use the following command to perform "
"administrative tasks in the jail whose JID is `3`:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:492
#, no-wrap
msgid "# jexec 3 tcsh\n"
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:495
#, no-wrap
msgid "Upgrading"
msgstr "升级"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:498
msgid ""
"The design of this setup provides an easy way to upgrade existing jails "
"while minimizing their downtime. Also, it provides a way to roll back to the "
"older version should a problem occur."
msgstr ""
"有时， 由于安全问题， 或新增功能有用， 会希望将系统升级到一个新版本的 FreeBSD。 这种安装方式的设计使得升级现有 jail 变得很容易。 另外，"
" 它也能最大限度地减小停机时间， 因为 jail 只在最后时刻才需要关闭。 另外， 它也提供了简单的回退到先前版本的方法。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:501
msgid ""
"The first step is to upgrade the host system. Then, create a new temporary "
"read-only template in [.filename]#/home/j/mroot2#."
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:510
#, no-wrap
msgid ""
"# mkdir /home/j/mroot2\n"
"# cd /usr/src\n"
"# make installworld DESTDIR=/home/j/mroot2\n"
"# cd /home/j/mroot2\n"
"# cpdup /usr/src usr/src\n"
"# mkdir s\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:513
msgid ""
"  The `installworld` creates a few unnecessary directories, which should be "
"removed:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:518
#, no-wrap
msgid ""
"# chflags -R 0 var\n"
"# rm -R etc var root usr/local tmp\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:521
msgid "Recreate the read-write symlinks for the master file system:"
msgstr "重建到主系统中的可读写符号连接："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:531
#, no-wrap
msgid ""
"# ln -s s/etc etc\n"
"# ln -s s/root root\n"
"# ln -s s/home home\n"
"# ln -s ../s/usr-local usr/local\n"
"# ln -s ../s/usr-X11R6 usr/X11R6\n"
"# ln -s s/tmp tmp\n"
"# ln -s s/var var\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:534
msgid "Next, stop the jails:"
msgstr "现在是时候关闭 jail 了："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:538
#, no-wrap
msgid "# service jail stop\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:541
msgid ""
"Unmount the original file systems as the read-write systems are attached to "
"the read-only system ([.filename]#/s#):"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:550
#, no-wrap
msgid ""
"# umount /home/j/ns/s\n"
"# umount /home/j/ns\n"
"# umount /home/j/mail/s\n"
"# umount /home/j/mail\n"
"# umount /home/j/www/s\n"
"# umount /home/j/www\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:553
msgid ""
"Move the old read-only file system and replace it with the new one. This "
"will serve as a backup and archive of the old read-only file system should "
"something go wrong. The naming convention used here corresponds to when a "
"new read-only file system has been created. Move the original FreeBSD Ports "
"Collection over to the new file system to save some space and inodes:"
msgstr ""
"将先前的只读文件系统挪走， 换成新的系统。 这样做也同时保留了先前系统的备份， 从而可以在出现问题时从中恢复。 这里我们根据新系统的创建时间来命名。 "
"此外我们把先前的 FreeBSD Ports 套件直接移动到新的文件系统中， 以节省磁盘空间和 inode："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:560
#, no-wrap
msgid ""
"# cd /home/j\n"
"# mv mroot mroot.20060601\n"
"# mv mroot2 mroot\n"
"# mv mroot.20060601/usr/ports mroot/usr\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:563
msgid ""
"At this point the new read-only template is ready, so the only remaining "
"task is to remount the file systems and start the jails:"
msgstr "现在新的只读模板就可以用了， 剩下的事情是重新挂接文件系统并启动 jails："

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:571
msgid ""
"Use `jls` to check if the jails started correctly. Run `mergemaster` in each "
"jail to update the configuration files."
msgstr ""

#. type: Title ==
#: documentation/content/en/books/handbook/jails/_index.adoc:573
#, no-wrap
msgid "Managing Jails with ezjail"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:576
msgid ""
"Creating and managing multiple jails can quickly become tedious and "
"error-prone. Dirk Engling's ezjail automates and greatly simplifies many "
"jail tasks. A _basejail_ is created as a template. Additional jails use "
"man:mount_nullfs[8] to share many of the basejail directories without using "
"additional disk space. Each additional jail takes only a few megabytes of "
"disk space before applications are installed. Upgrading the copy of the "
"userland in the basejail automatically upgrades all of the other jails."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:578
msgid ""
"Additional benefits and features are described in detail on the ezjail web "
"site, https://erdgeist.org/arts/software/ezjail/[]."
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:580
#, no-wrap
msgid "Installing ezjail"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:583
msgid ""
"Installing ezjail consists of adding a loopback interface for use in jails, "
"installing the port or package, and enabling the service."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:587
msgid ""
"To keep jail loopback traffic off the host's loopback network interface "
"`lo0`, a second loopback interface is created by adding an entry to "
"[.filename]#/etc/rc.conf#:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:591
#: documentation/content/en/books/handbook/jails/_index.adoc:962
#, no-wrap
msgid "cloned_interfaces=\"lo1\"\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:594
msgid ""
"  The second loopback interface `lo1` will be created when the system "
"starts. It can also be created manually without a restart:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:600
#: documentation/content/en/books/handbook/jails/_index.adoc:970
#, no-wrap
msgid ""
"# service netif cloneup\n"
"Created clone interfaces: lo1.\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:603
msgid ""
"  Jails can be allowed to use aliases of this secondary loopback interface "
"without interfering with the host."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:605
msgid ""
"  Inside a jail, access to the loopback address `127.0.0.1` is redirected to "
"the first IP address assigned to the jail. To make the jail loopback "
"correspond with the new `lo1` interface, that interface must be specified "
"first in the list of interfaces and IP addresses given when creating a new "
"jail."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:607
msgid "  Give each jail a unique loopback address in the `127.0.0.0/8` netblock."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:608
msgid "Install package:sysutils/ezjail[]:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:613
#, no-wrap
msgid ""
"# cd /usr/ports/sysutils/ezjail\n"
"# make install clean\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:616
msgid "Enable ezjail by adding this line to [.filename]#/etc/rc.conf#:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:620
#, no-wrap
msgid "ezjail_enable=\"YES\"\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:623
msgid ""
"The service will automatically start on system boot. It can be started "
"immediately for the current session:"
msgstr "ezjail 将在系统启动时启动。现在使用此命令启动 ezjail："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:627
#, no-wrap
msgid "# service ezjail start\n"
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:630
#, no-wrap
msgid "Initial Setup"
msgstr "初始设定"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:633
msgid ""
"With ezjail installed, the basejail directory structure can be created and "
"populated. This step is only needed once on the jail host computer."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:635
msgid ""
"In both of these examples, `-p` causes the ports tree to be retrieved with "
"man:portsnap[8] into the basejail. That single copy of the ports directory "
"will be shared by all the jails. Using a separate copy of the ports "
"directory for jails isolates them from the host. The ezjailFAQ explains in "
"more detail: http://erdgeist.org/arts/software/ezjail/#FAQ[]."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:640
msgid "To Populate the Jail with FreeBSD-RELEASE"
msgstr "在 jail 中使用 FreeBSD-RELEASE"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:642
msgid ""
"  For a basejail based on the FreeBSD RELEASE matching that of the host "
"computer, use `install`. For example, on a host computer running FreeBSD "
"10-STABLE, the latest RELEASE version of FreeBSD -10 will be installed in "
"the jail):"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:646
#, no-wrap
msgid "# ezjail-admin install -p\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:649
msgid "To Populate the Jail with `installworld`"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:651
msgid ""
"  The basejail can be installed from binaries created by `buildworld` on the "
"host with `ezjail-admin update`."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:653
msgid ""
"  In this example, FreeBSD 10-STABLE has been built from source. The jail "
"directories are created. Then `installworld` is executed, installing the "
"host's [.filename]#/usr/obj# into the basejail."
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:657
#, no-wrap
msgid "# ezjail-admin update -i -p\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:660
msgid ""
"  The host's [.filename]#/usr/src# is used by default. A different source "
"directory on the host can be specified with `-s` and a path, or set with "
"`ezjail_sourcetree` in [.filename]#/usr/local/etc/ezjail.conf#."
msgstr ""

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:665
msgid ""
"The basejail's ports tree is shared by other jails. However, downloaded "
"distfiles are stored in the jail that downloaded them. By default, these "
"files are stored in [.filename]#/var/ports/distfiles# within each "
"jail. [.filename]#/var/ports# inside each jail is also used as a work "
"directory when building ports."
msgstr ""

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:671
msgid ""
"The FTP protocol is used by default to download packages for the "
"installation of the basejail. Firewall or proxy configurations can prevent "
"or interfere with FTP transfers. The HTTP protocol works differently and "
"avoids these problems. It can be chosen by specifying a full URL for a "
"particular download mirror in [.filename]#/usr/local/etc/ezjail.conf#:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:675
#, no-wrap
msgid "ezjail_ftphost=http://ftp.FreeBSD.org\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:678
msgid "See crossref:mirrors[mirrors-ftp,“FTP Sites”] for a list of sites."
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:681
#, no-wrap
msgid "Creating and Starting a New Jail"
msgstr "建立并启动新的Jail"

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:684
msgid ""
"New jails are created with `ezjail-admin create`. In these examples, the "
"`lo1` loopback interface is used as described above."
msgstr ""

#. type: Block title
#: documentation/content/en/books/handbook/jails/_index.adoc:686
#, no-wrap
msgid "Procedure: Create and Start a New Jail"
msgstr ""

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:688
msgid ""
"Create the jail, specifying a name and the loopback and network interfaces "
"to use, along with their IP addresses. In this example, the jail is named "
"`dnsjail`."
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:692
#, no-wrap
msgid "# ezjail-admin create dnsjail 'lo1|127.0.1.1,em0|192.168.1.50'\n"
msgstr ""

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:698
msgid ""
"Most network services run in jails without problems. A few network services, "
"most notably man:ping[8], use _raw network sockets_. In jails, raw network "
"sockets are disabled by default for security. Services that require them "
"will not work."
msgstr ""

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:700
msgid ""
"Occasionally, a jail genuinely needs raw sockets. For example, network "
"monitoring applications often use man:ping[8] to check the availability of "
"other computers. When raw network sockets are actually needed in a jail, "
"they can be enabled by editing the ezjail configuration file for the "
"individual jail, [.filename]#/usr/local/etc/ezjail/jailname#. Modify the "
"`parameters` entry:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:704
#, no-wrap
msgid "export jail_jailname_parameters=\"allow.raw_sockets=1\"\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:707
msgid ""
"Do not enable raw network sockets unless services in the jail actually "
"require them."
msgstr "不要启用原始网络套接字，除非 jail 中的服务真的需要它。"

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:710
msgid "Start the jail:"
msgstr "启动 jial："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:714
#, no-wrap
msgid "# ezjail-admin start dnsjail\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:717
msgid "Use a console on the jail:"
msgstr "打开 dnsjail jail 的控制台："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:721
#, no-wrap
msgid "# ezjail-admin console dnsjail\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:724
msgid ""
"The jail is operating and additional configuration can be completed. Typical "
"settings added at this point include:"
msgstr "Jail 开始运行，可以完成额外的配置。这时添加的典型设置包括："

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:727
msgid "Set the `root` Password"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:729
msgid "  Connect to the jail and set the `root` user's password:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:737
#, no-wrap
msgid ""
"# ezjail-admin console dnsjail\n"
"# passwd\n"
"Changing local password for root\n"
"New Password:\n"
"Retype New Password:\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:740
msgid "Time Zone Configuration"
msgstr "设置时区"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:742
msgid ""
"  The jail's time zone can be set with man:tzsetup[8]. To avoid spurious "
"error messages, the man:adjkerntz[8] entry in [.filename]#/etc/crontab# can "
"be commented or removed. This job attempts to update the computer's hardware "
"clock with time zone changes, but jails are not allowed to access that "
"hardware."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:743
msgid "DNS Servers"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:745
msgid ""
"  Enter domain name server lines in [.filename]#/etc/resolv.conf# so DNS "
"works in the jail."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:746
msgid "Edit [.filename]#/etc/hosts#"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:748
msgid ""
"  Change the address and add the jail name to the `localhost` entries in "
"[.filename]#/etc/hosts#."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:749
msgid "Configure [.filename]#/etc/rc.conf#"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:751
msgid ""
"  Enter configuration settings in [.filename]#/etc/rc.conf#. This is much "
"like configuring a full computer. The host name and IP address are not set "
"here. Those values are already provided by the jail configuration."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:753
msgid ""
"With the jail configured, the applications for which the jail was created "
"can be installed."
msgstr "配置好 jail 后，可以在该 jail 中安装应用程序。"

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:758
msgid ""
"Some ports must be built with special options to be used in a jail. For "
"example, both of the network monitoring plugin packages "
"package:net-mgmt/nagios-plugins[] and package:net-mgmt/monitoring-plugins[] "
"have a `JAIL` option which must be enabled for them to work correctly inside "
"a jail."
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:761
#, no-wrap
msgid "Updating Jails"
msgstr "更新Jail"

#. type: Title ====
#: documentation/content/en/books/handbook/jails/_index.adoc:764
#, no-wrap
msgid "Updating the Operating System"
msgstr "更新操作系统"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:767
msgid ""
"Because the basejail's copy of the userland is shared by the other jails, "
"updating the basejail automatically updates all of the other jails. Either "
"source or binary updates can be used."
msgstr ""
"因为basejail的用户的副本是由其他 jail 共享的，所以更新basejail会自动更新所有其他 jail。可以使用源码或二进制文件更新。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:769
msgid ""
"To build the world from source on the host, then install it in the basejail, "
"use:"
msgstr "在宿主机上从源码编译FreeBSD基础系统，并将其装入basejail中："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:773
#, no-wrap
msgid "# ezjail-admin update -b\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:776
msgid ""
"If the world has already been compiled on the host, install it in the "
"basejail with:"
msgstr "如果已经在主机上编译好 world，使用以下命令将其安装到 basejail 中："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:780
#, no-wrap
msgid "# ezjail-admin update -i\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:783
msgid ""
"Binary updates use man:freebsd-update[8]. These updates have the same "
"limitations as if man:freebsd-update[8] were being run directly. The most "
"important one is that only -RELEASE versions of FreeBSD are available with "
"this method."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:785
msgid ""
"Update the basejail to the latest patched release of the version of FreeBSD "
"on the host. For example, updating from RELEASE-p1 to RELEASE-p2."
msgstr "使用主机中的 FreeBSD 补丁更新 basejail，例如从 RELEASE-p1 更新到 RELEASE-p2。"

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:789
#, no-wrap
msgid "# ezjail-admin update -u\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:792
msgid ""
"To upgrade the basejail to a new version, first upgrade the host system as "
"described in crossref:cutting-edge[freebsdupdate-upgrade,“Performing Major "
"and Minor Version Upgrades”]. Once the host has been upgraded and rebooted, "
"the basejail can then be upgraded. man:freebsd-update[8] has no way of "
"determining which version is currently installed in the basejail, so the "
"original version must be specified. Use man:file[1] to determine the "
"original version in the basejail:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:797
#, no-wrap
msgid ""
"# file /usr/jails/basejail/bin/sh\n"
"/usr/jails/basejail/bin/sh: ELF 64-bit LSB executable, x86-64, version 1 "
"(FreeBSD), dynamically linked (uses shared libs), for FreeBSD 9.3, "
"stripped\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:800
msgid ""
"Now use this information to perform the upgrade from `9.3-RELEASE` to the "
"current version of the host system:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:804
#, no-wrap
msgid "# ezjail-admin update -U -s 9.3-RELEASE\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:807
msgid ""
"After updating the basejail, man:mergemaster[8] must be run to update each "
"jail's configuration files."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:809
msgid ""
"How to use man:mergemaster[8] depends on the purpose and trustworthiness of "
"a jail. If a jail's services or users are not trusted, then "
"man:mergemaster[8] should only be run from within that jail:"
msgstr ""

#. type: Block title
#: documentation/content/en/books/handbook/jails/_index.adoc:811
#, no-wrap
msgid "man:mergemaster[8] on Untrusted Jail"
msgstr ""

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:815
msgid ""
"Delete the link from the jail's [.filename]#/usr/src# into the basejail and "
"create a new [.filename]#/usr/src# in the jail as a mountpoint. Mount the "
"host computer's [.filename]#/usr/src# read-only on the jail's new "
"[.filename]#/usr/src# mountpoint:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:821
#, no-wrap
msgid ""
"# rm /usr/jails/jailname/usr/src\n"
"# mkdir /usr/jails/jailname/usr/src\n"
"# mount -t nullfs -o ro /usr/src /usr/jails/jailname/usr/src\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:824
msgid "Get a console in the jail:"
msgstr "打开 jail 的控制台："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:828
#, no-wrap
msgid "# ezjail-admin console jailname\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:831
msgid "Inside the jail, run `mergemaster`. Then exit the jail console:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:837
#, no-wrap
msgid ""
"# cd /usr/src\n"
"# mergemaster -U\n"
"# exit\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:840
msgid "Finally, unmount the jail's [.filename]#/usr/src#:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:844
#, no-wrap
msgid "# umount /usr/jails/jailname/usr/src\n"
msgstr ""

#. type: Block title
#: documentation/content/en/books/handbook/jails/_index.adoc:849
#, no-wrap
msgid "man:mergemaster[8] on Trusted Jail"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:854
msgid ""
"If the users and services in a jail are trusted, man:mergemaster[8] can be "
"run from the host:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:858
#, no-wrap
msgid "# mergemaster -U -D /usr/jails/jailname\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:866
msgid ""
"After a major version update it is recommended by package:sysutils/ezjail[] "
"to make sure your `pkg` is of the correct version. Therefore enter:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:870
#, no-wrap
msgid "# pkg-static upgrade -f pkg\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:873
msgid "to upgrade or downgrade to the appropriate version."
msgstr "升级到或降级到适当的版本。"

#. type: Title ====
#: documentation/content/en/books/handbook/jails/_index.adoc:876
#, no-wrap
msgid "Updating Ports"
msgstr "更新Port"

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:879
msgid ""
"The ports tree in the basejail is shared by the other jails. Updating that "
"copy of the ports tree gives the other jails the updated version also."
msgstr "basejail 中的 port 和其他 jail 共享。更新该 port 树时也会更新其他 jail 的 port。"

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:881
msgid "The basejail ports tree is updated with man:portsnap[8]:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:885
#, no-wrap
msgid "# ezjail-admin update -P\n"
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:888
#, no-wrap
msgid "Controlling Jails"
msgstr "控制Jail"

#. type: Title ====
#: documentation/content/en/books/handbook/jails/_index.adoc:891
#, no-wrap
msgid "Stopping and Starting Jails"
msgstr "停止与启动Jail"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:894
msgid ""
"ezjail automatically starts jails when the computer is started. Jails can be "
"manually stopped and restarted with `stop` and `start`:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:899
#, no-wrap
msgid ""
"# ezjail-admin stop sambajail\n"
"Stopping jails: sambajail.\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:902
msgid ""
"By default, jails are started automatically when the host computer "
"starts. Autostarting can be disabled with `config`:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:906
#, no-wrap
msgid "# ezjail-admin config -r norun seldomjail\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:909
msgid ""
"This takes effect the next time the host computer is started. A jail that is "
"already running will not be stopped."
msgstr "这将在下次启动主机时生效。已运行的 jail 不会停止。"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:911
msgid "Enabling autostart is very similar:"
msgstr "开启自动启动："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:915
#, no-wrap
msgid "# ezjail-admin config -r run oftenjail\n"
msgstr ""

#. type: Title ====
#: documentation/content/en/books/handbook/jails/_index.adoc:918
#, no-wrap
msgid "Archiving and Restoring Jails"
msgstr "封存与还原Jail"

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:921
msgid ""
"Use `archive` to create a [.filename]#.tar.gz# archive of a jail. The file "
"name is composed from the name of the jail and the current date. Archive "
"files are written to the archive directory, "
"[.filename]#/usr/jails/ezjail_archives#. A different archive directory can "
"be chosen by setting `ezjail_archivedir` in the configuration file."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:923
msgid ""
"The archive file can be copied elsewhere as a backup, or an existing jail "
"can be restored from it with `restore`. A new jail can be created from the "
"archive, providing a convenient way to clone existing jails."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:925
msgid "Stop and archive a jail named `wwwserver`:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:933
#, no-wrap
msgid ""
"# ezjail-admin stop wwwserver\n"
"Stopping jails: wwwserver.\n"
"# ezjail-admin archive wwwserver\n"
"# ls /usr/jails/ezjail-archives/\n"
"wwwserver-201407271153.13.tar.gz\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:936
msgid ""
"Create a new jail named `wwwserver-clone` from the archive created in the "
"previous step. Use the [.filename]#em1# interface and assign a new IP "
"address to avoid conflict with the original:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:940
#, no-wrap
msgid ""
"# ezjail-admin create -a "
"/usr/jails/ezjail_archives/wwwserver-201407271153.13.tar.gz wwwserver-clone "
"'lo1|127.0.3.1,em1|192.168.1.51'\n"
msgstr ""

#. type: Title ===
#: documentation/content/en/books/handbook/jails/_index.adoc:943
#, no-wrap
msgid "Full Example: BIND in a Jail"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:946
msgid ""
"Putting the BINDDNS server in a jail improves security by isolating it. This "
"example creates a simple caching-only name server."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:948
msgid "The jail will be called `dns1`."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:949
msgid "The jail will use IP address `192.168.1.240` on the host's `re0` interface."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:950
msgid "The upstream ISP's DNS servers are at `10.0.0.62` and `10.0.0.61`."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:951
msgid ""
"The basejail has already been created and a ports tree installed as shown in "
"<<jails-ezjail-initialsetup>>."
msgstr ""

#. type: Block title
#: documentation/content/en/books/handbook/jails/_index.adoc:953
#, no-wrap
msgid "Running BIND in a Jail"
msgstr "在Jail中执行BIND"

#. type: delimited block = 4
#: documentation/content/en/books/handbook/jails/_index.adoc:958
msgid ""
"Create a cloned loopback interface by adding a line to "
"[.filename]#/etc/rc.conf#:"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:965
msgid "Immediately create the new loopback interface:"
msgstr "创建新的回环接口："

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:973
msgid "Create the jail:"
msgstr "创建 Jail："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:977
#, no-wrap
msgid "# ezjail-admin create dns1 'lo1|127.0.2.1,re0|192.168.1.240'\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:980
msgid ""
"Start the jail, connect to a console running on it, and perform some basic "
"configuration:"
msgstr "启动 jail 并连接到它的控制台，进行基础配置："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:992
#, no-wrap
msgid ""
"# ezjail-admin start dns1\n"
"# ezjail-admin console dns1\n"
"# passwd\n"
"Changing local password for root\n"
"New Password:\n"
"Retype New Password:\n"
"# tzsetup\n"
"# sed -i .bak -e '/adjkerntz/ s/^/#/' /etc/crontab\n"
"# sed -i .bak -e 's/127.0.0.1/127.0.2.1/g; "
"s/localhost.my.domain/dns1.my.domain dns1/' /etc/hosts\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:995
msgid ""
"Temporarily set the upstream DNS servers in [.filename]#/etc/resolv.conf# so "
"ports can be downloaded:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1000
#, no-wrap
msgid ""
"nameserver 10.0.0.62\n"
"nameserver 10.0.0.61\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1003
msgid "Still using the jail console, install package:dns/bind99[]."
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1007
#, no-wrap
msgid "# make -C /usr/ports/dns/bind99 install clean\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1010
msgid ""
"Configure the name server by editing "
"[.filename]#/usr/local/etc/namedb/named.conf#."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1012
msgid ""
"Create an Access Control List (ACL) of addresses and networks that are "
"permitted to send DNS queries to this name server. This section is added "
"just before the `options` section already in the file:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1017
#, no-wrap
msgid ""
"...\n"
"// or cause huge amounts of useless Internet traffic.\n"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1023
#, no-wrap
msgid ""
"acl \"trusted\" {\n"
"\t192.168.1.0/24;\n"
"\tlocalhost;\n"
"\tlocalnets;\n"
"};\n"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1026
#, no-wrap
msgid ""
"options {\n"
"...\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1029
msgid ""
"Use the jail IP address in the `listen-on` setting to accept DNS queries "
"from other computers on the network:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1033
#, no-wrap
msgid "\tlisten-on\t{ 192.168.1.240; };\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1036
msgid ""
"A simple caching-only DNS name server is created by changing the "
"`forwarders` section. The original file contains:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1044
#, no-wrap
msgid ""
"/*\n"
"\tforwarders {\n"
"\t\t127.0.0.1;\n"
"\t};\n"
"*/\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1047
msgid ""
"Uncomment the section by removing the `/\\*` and `*/` lines. Enter the IP "
"addresses of the upstream DNS servers. Immediately after the `forwarders` "
"section, add references to the `trusted` ACL defined earlier:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1054
#, no-wrap
msgid ""
"\tforwarders {\n"
"\t\t10.0.0.62;\n"
"\t\t10.0.0.61;\n"
"\t};\n"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1058
#, no-wrap
msgid ""
"\tallow-query       { any; };\n"
"\tallow-recursion   { trusted; };\n"
"\tallow-query-cache { trusted; };\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1061
msgid "Enable the service in [.filename]#/etc/rc.conf#:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1065
#, no-wrap
msgid "named_enable=\"YES\"\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1068
msgid "Start and test the name server:"
msgstr "启动并测试域名服务器："

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1075
#, no-wrap
msgid ""
"# service named start\n"
"wrote key file \"/usr/local/etc/namedb/rndc.key\"\n"
"Starting named.\n"
"# /usr/local/bin/dig @192.168.1.240 freebsd.org\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1078
msgid "A response that includes"
msgstr "回应中应包含以下信息"

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1082
#, no-wrap
msgid ";; Got answer;\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1085
msgid ""
"shows that the new DNS server is working. A long delay followed by a "
"response including"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1089
#, no-wrap
msgid ";; connection timed out; no servers could be reached\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1092
msgid ""
"shows a problem. Check the configuration settings and make sure any local "
"firewalls allow the new DNS access to the upstream DNS servers."
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1094
msgid ""
"The new DNS server can use itself for local name resolution, just like other "
"local computers. Set the address of the DNS server in the client computer's "
"[.filename]#/etc/resolv.conf#:"
msgstr ""

#. type: delimited block . 4
#: documentation/content/en/books/handbook/jails/_index.adoc:1098
#, no-wrap
msgid "nameserver 192.168.1.240\n"
msgstr ""

#. type: Plain text
#: documentation/content/en/books/handbook/jails/_index.adoc:1101
msgid ""
"A local DHCP server can be configured to provide this address for a local "
"DNS server, providing automatic configuration on DHCP clients."
msgstr ""
